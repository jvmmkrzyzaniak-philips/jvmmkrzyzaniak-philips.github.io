import React, { useState, lazy, Suspense, useMemo } from 'react'
import { useInfoSheet } from '@fs/zion-ui'
import { useEvent } from '@fs/zion-frontend-friends'
import { PersonSheetContext } from './usePersonSheet'

const PersonSheet = lazy(() => import('./PersonSheet'))

export default function PersonSheetProvider({ children, showPQSTag = false }) {
  const personSheet = useInfoSheet()
  const [data, setData] = useState()
  const setPerson = useEvent((personData) => {
    setData(personData)
  })
  const setSheetHeight = useEvent((initialHeight) => {
    personSheet.setBottomSheetHeight(initialHeight)
  })

  const value = useMemo(() => ({ setPerson, setSheetHeight, personSheet }), [personSheet, setPerson, setSheetHeight])

  return (
    <PersonSheetContext.Provider value={value}>
      {children}
      {data && (
        <Suspense fallback="">
          <PersonSheet sheet={personSheet} showPQSTag={showPQSTag} {...data} />
        </Suspense>
      )}
    </PersonSheetContext.Provider>
  )
}
