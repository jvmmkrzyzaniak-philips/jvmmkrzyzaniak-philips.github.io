import axios from '@fs/zion-axios'
import { getPersonObj } from '@fs/zion-person-service'

export default async function updateOtherRelationship(
  personNumber,
  associationId,
  newPersonId,
  reason = '',
  abortController
) {
  const url = `/service/tree/tree-data/relationship/association/${associationId}/update/person${personNumber}?newPerson${personNumber}Id=${newPersonId}`
  return axios.put(url, { reason }, { signal: abortController?.signal })
}

export const isChildRelated = async ({ childId, parentIds }) => {
  const [serverPromise] = await getPersonObj(childId, 'full')
  const child = await serverPromise
  const realParentIds =
    child?.parents?.map((parent) => [parent?.parent1?.id, parent?.parent2?.id].filter(Boolean)).flat() || []
  return !!realParentIds?.find((realParentId) => parentIds.includes(realParentId))
}

export const isSpouseRelated = async ({ personId, spouseId }) => {
  const [serverPromise] = await getPersonObj(personId, 'full')
  const person = await serverPromise
  const coupleIds = person?.spouses?.map((spouse) => spouse.coupleId) || []
  return coupleIds.find((coupleId) => coupleId.includes(spouseId))
}
